      SUBROUTINE S_XPTARCALIB(ABORT,err)
*--------------------------------------------------------
*-
*-   Purpose and Methods : Correct xptar or other reconstructed
*-                         physics variables
*-                         for magnet saturation effects
*-                              
*-                                to decoded information 
*-
*-      Required Input BANKS     SOS_FOCAL_PLANE
*-                               SOS_TARGET
*-
*-      Output BANKS             SOS_PHYSICS_R4
*-                               SOS_PHYSICS_I4
*-
*-   Output: ABORT           - success or failure
*-         : err             - reason for failure, if any
*- 
*-   Created 4-JUN-2004   C. Xu
*-                           Dummy Shell routine
* $Log: s_xptarcalib.f,v $
* Revision 1.1.2.2  2004/07/01 19:15:50  jones
* Defined variable 'i' and correct some typos. Fpi2 branch
*
* Revision 1.1.2.1  2004/07/01 14:49:50  jones
* New codes to correct SOS ytar, xptar and yptar for the fpi2
* branch of Analyzer.
*
*
*-
*-
*--------------------------------------------------------
      IMPLICIT NONE
      SAVE
*
      character*9 here
      parameter (here= 'S_XPTARCALIB')
*
      logical ABORT
      character*(*) err
      integer ierr,i
*
      include 'gen_data_structures.cmn'
      INCLUDE 'sos_data_structures.cmn'
      INCLUDE 'gen_constants.par'
      INCLUDE 'gen_units.par'
*
*     local variables 
*
      REAL*4 c(75),xptarcorr
      real*4 xp, yp, ytar

*--------------------------------------------------------
*
      ierr=0
      ABORT=.FALSE.

      xptarcorr=0.

      xp=ssxp_tar
      yp=ssyp_tar
      ytar=ssy_tar

      do i=1,75
      c(i)=0.0
      enddo
 
      if(abs(spcentral-0.9).lt.0.2)   then
        c(1) =      -0.27664E-03   
        c(2) =       0.27604E-03   
        c(3) =       0.63051E-02   
        c(4) =       0.57772E-05   
        c(5) =      -0.13939       
        c(6) =      -0.13306E-01   
        c(7) =       0.10768E-02   
        c(8) =      -0.53957E-01   
        c(9) =       0.11808E-02   
       c(10) =     -0.76569E-04   
       c(11) =      -1.1113       
       c(12) =      0.37138E-02   
       c(13) =       1.5503       
       c(14) =      0.96445E-03   
       c(15) =      0.21188E-01   
       c(16) =      0.81954E-02   
       c(17) =     -0.49953E-04   
       c(18) =       1.5188       
       c(19) =      -7.0499       
       c(20) =     -0.12617E-01   
       c(21) =     -0.51768E-02   
       c(22) =       19.838       
       c(23) =     -0.57672       
       c(24) =     -0.69668E-01   
       c(25) =       20.663       
       c(26) =       6.9068       
       c(27) =       5.8623       
       c(28) =      0.72338       
       c(29) =       2693.8       
       c(30) =      -23.918       
       c(31) =       1.2739       
       c(32) =      -6612.0       
       c(33) =      -738.89       
       c(34) =       5.9937       
       c(35) =      -6380.2       
       c(36) =       252.44       
       c(37) =       1348.3       
       c(38) =      0.14835       
       c(39) =      -13.142       
       c(40) =     -0.69570E-01   
       c(41) =       81.186       
       c(42) =       8.7311       
       c(43) =      0.72769E-01   
       c(44) =      -117.67       
       c(45) =      -5.3271       
       c(46) =       48.264       
       c(47) =      -4.3438       
       c(48) =       177.47       
       c(49) =      0.32675       
       c(50) =       13724.       
       c(51) =       164.91       
       c(52) =       1.3755       
       c(53) =       597.93       
       c(54) =       1364.9       
       c(55) =      -106.09       
       c(56) =      0.58510E+06   
       c(57) =     -0.13716E+06   
       c(58) =       11366.       
       c(59) =     -0.36122E+06   
       c(60) =     -0.18516E+06   
       c(61) =     -0.36122E+06   
       c(62) =     -0.18516E+06   
       c(63) =      0.21939E+07   
       c(64) =      -37.576       
       c(65) =      -958.50       
       c(66) =      -9.3473       
       c(67) =       39153.       
       c(68) =       821.71       
       c(69) =       15.682       
       c(70) =      0.51093E+06   
       c(71) =       12954.       
       c(72) =      -375.86       
       c(73) =     -0.15465E+06   
       c(74) =       29948.       
       c(75) =      0.16727E+06   
      endif


      if(abs(spcentral-1.65).lt.0.03) then
        c(1) =          -0.10169E-03
        c(2) =          0.14203E-03
        c(3) =          0.96077E-03
        c(4) =          -0.50005E-05
        c(5) =          -0.65478E-01
        c(6) =          0.15754E-01
        c(7) =          0.61991E-04
        c(8) =          -0.22964E-01
        c(9) =          0.67100E-04
       c(10) =          -0.25522E-04
       c(11) =             0.18472
       c(12) =      0.59909E-02
       c(13) =       0.42919     
       c(14) =         0.25890E-04
       c(15) =         0.52270E-02
       c(16) =         0.16771E-02
       c(17) =         0.64617E-04
       c(18) =             0.27685
       c(19) =              -5.3448
       c(20) =        -0.15162E-01
       c(21) =         0.35281E-02
       c(22) =             8.4424
       c(23) =             0.24524E-01
       c(24) =         0.48938E-01
       c(25) =             3.1634
       c(26) =             1.2517
       c(27) =              11.250 
       c(28) =             0.74537E-01
       c(29) =              516.01
       c(30) =             -3.1935
       c(31) =             0.13207
       c(32) =              11023.
       c(33) =             117.48
       c(34) =             -3.9679
       c(35) =              -483.82
       c(36) =              11.480
       c(37) =              -705.41
       c(38) =        -0.97677E-02
       c(39) =             4.0736
       c(40) =             -0.53456E-02
       c(41) =             -178.62
       c(42) =        1.9515
       c(43) =         -0.31864E-02
       c(44) =           38.838   
       c(45) =             0.58003
       c(46) =             -50.816
       c(47) =              -2.6852
       c(48) =          51.835    
       c(49) =           0.33356 
       c(50) =           1864.5   
       c(51) =           15.530   
       c(52) =           -0.30790 
       c(53) =         -0.18937E+06
       c(54) =       2040.8       
       c(55) =       2.3716      
       c(56) =        0.22431E+08
       c(57) =         -65600.
       c(58) =           1326.2  
       c(59) =        0.16664E+07
       c(60) =             -82873.
       c(61) =        0.16664E+07
       c(62) =        -82873.    
       c(63) =       0.35386E+07 
       c(64) =          -36.311    
       c(65) =          482.94    
       c(66) =          8.0757    
       c(67) =         11659.    
       c(68) =       285.68       
       c(69) =       -9.9342      
       c(70) =       68887.  
       c(71) =          9667.0   
       c(72) =         80.688    
       c(73) =        90428.
       c(74) =        5337.8     
       c(75) =           -3313.3   
      endif


      if(abs(spcentral-1.74).lt.0.03) then     
        c(1) =       0.21087E-03   
        c(2) =       0.28302E-03   
        c(3) =      -0.27522E-02   
        c(4) =      -0.10152E-04   
        c(5) =       0.13032       
        c(6) =       0.19347E-01   
        c(7) =       0.21397E-02   
        c(8) =       0.39299E-01   
        c(9) =       0.54323E-03   
       c(10) =      0.42139E-04   
       c(11) =      0.52727       
       c(12) =      0.13238E-01   
       c(13) =      0.29839       
       c(14) =     -0.75986E-03   
       c(15) =      0.30253E-01   
       c(16) =     -0.16556E-02   
       c(17) =      0.12924E-03   
       c(18) =      0.82685       
       c(19) =       37.546       
       c(20) =     -0.63313E-02   
       c(21) =      0.11993E-01   
       c(22) =      0.98362       
       c(23) =     -0.11874       
       c(24) =      0.16221E-01   
       c(25) =      -7.9336       
       c(26) =     -0.66822       
       c(27) =       51.618       
       c(28) =      0.75757       
       c(29) =       1739.1       
       c(30) =      -12.084       
       c(31) =      0.45794       
       c(32) =       6790.0       
       c(33) =      -113.82       
       c(34) =       33.144       
       c(35) =       5898.8       
       c(36) =       957.45       
       c(37) =       10683.       
       c(38) =     -0.26075E-02   
       c(39) =      -4.9500       
       c(40) =      0.17197       
       c(41) =      -63.075       
       c(42) =       13.393       
       c(43) =      0.31862E-01   
       c(44) =       167.79       
       c(45) =      -1.2746       
       c(46) =      -38.981       
       c(47) =       4.6266       
       c(48) =       165.66       
       c(49) =     -0.40437       
       c(50) =       7498.2       
       c(51) =       366.74       
       c(52) =     -0.17018       
       c(53) =      0.15611E+06   
       c(54) =      -703.90       
       c(55) =      -31.165       
       c(56) =     -0.12158E+07   
       c(57) =      0.20777E+06   
       c(58) =      -911.99       
       c(59) =     -0.36366E+06   
       c(60) =       71846.       
       c(61) =     -0.36366E+06   
       c(62) =       71846.       
       c(63) =     -0.10825E+07   
       c(64) =       54.677       
       c(65) =       1005.6       
       c(66) =       16.069       
       c(67) =      -11510.       
       c(68) =       579.53       
       c(69) =      -19.318       
       c(70) =      0.47424E+06   
       c(71) =       3488.9       
       c(72) =      -87.543       
       c(73) =     -0.11154E+06   
       c(74) =      -21117.       
       c(75) =       33136.       
      endif

        xptarcorr= c(1)    
     > +c(2)*yp+c(3)*xp 
     > +c(4)*ytar 
     > +c(5)*xp*xp 
     > +c(6)*xp*yp 
     > +c(7)*xp*ytar 
     > +c(8)*yp*yp 
     > +c(9)*yp*ytar 
     > +c(10)*ytar*ytar 
     > +c(11)*xp*xp*yp 
     > +c(12)*xp*xp*ytar 
     > +c(13)*xp*yp*yp 
     > +c(14)*xp*ytar*ytar 
     > +c(15)*xp*yp*ytar 
     > +c(16)*yp*yp*ytar 
     > +c(17)*yp*ytar*ytar 
     > +c(18)*xp*xp*yp*ytar 
     > +c(19)*xp*xp*yp*yp 
     > +c(20)*xp*xp*ytar*ytar 
     > +c(21)*xp*yp*ytar*ytar 
     > +c(22)*xp**2*yp**2*ytar 
     > +c(23)*xp**2*yp*ytar**2 
     > +c(24)*xp*yp**2*ytar**2 
     > +c(25)*xp**2*yp**2*ytar**2 
     > +c(26)*xp**3
     > +c(27)*xp**3*yp
     > +c(28)*xp**3*ytar
     > +c(29)*xp**3*yp**2
     > +c(30)*xp**3*yp*ytar           
     > +c(31)*xp**3*ytar**2
     > +c(32)*xp**3*yp**3
     > +c(33)*xp**3*yp**2*ytar   
     > +c(34)*xp**3*yp*ytar**2
     > +c(35)*xp**3*yp**3*ytar
     > +c(36)*xp**3*yp**2*ytar**2
     > +c(37)*xp**3*yp**3*ytar**2
     > +c(38)*yp**3
     > +c(39)*yp**3*xp
     > +c(40)*yp**3*ytar
     > +c(41)*yp**3*xp**2
     > +c(42)*yp**3*xp*ytar
     > +c(43)*yp**3*ytar**2
     > +c(44)*yp**3*xp**2*ytar 
     > +c(45)*yp**3*xp*ytar**2
     > +c(46)*yp**3*xp**2*ytar**2
     > +c(47)*yp**4
     > +c(48)*yp**4*xp
     > +c(49)*yp**4*ytar 
     > +c(50)*yp**4*xp**2
     > +c(51)*yp**4*xp*ytar 
     > +c(52)*yp**4*ytar**2
     > +c(53)*yp**4*xp**3
     > +c(54)*yp**4*xp**2*ytar
     > +c(55)*yp**4*xp*ytar**2
     > +c(56)*yp**4*xp**4
     > +c(57)*yp**4*xp**3*ytar
     > +c(58)*yp**4*xp**2*ytar**2
     > +c(59)*yp**4*xp**4*ytar
     > +c(60)*yp**4*xp**3*ytar**2
     > +c(61)*yp**4*xp**4*ytar
     > +c(62)*yp**4*xp**3*ytar**2
     > +c(63)*yp**4*xp**4*ytar**2
     > +c(64)*xp**4
     > +c(65)*xp**4*yp
     > +c(66)*xp**4*ytar
     > +c(67)*xp**4*yp**2
     > +c(68)*xp**4*yp*ytar
     > +c(69)*xp**4*ytar**2
     > +c(70)*xp**4*yp**3
     > +c(71)*xp**4*yp**2*ytar
     > +c(72)*xp**4*yp*ytar**2
     > +c(73)*xp**4*yp**3*ytar
     > +c(74)*xp**4*yp**2*ytar**2
     > +c(75)*xp**4*yp**3*ytar**2

! ----------------------------------------------------
! TH - TEST XPTAR CORRECTION
       
!        write(*,*) 's_xptarcalib.f - BEFORE ',ssxp_tar,xptarcorr

       ssxp_tar = ssxp_tar + xptarcorr 

!        write(*,*) 's_xptarcalib.f - AFTER ',ssxp_tar

! ----------------------------------------------------

      ABORT= ierr.ne.0 .or. ABORT

      return
      end



